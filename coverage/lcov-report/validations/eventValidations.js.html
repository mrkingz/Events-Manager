<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for validations/eventValidations.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\prettify.css" />
    <link rel="stylesheet" href="..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\index.html">All files</a> / <a href="index.html">validations</a> eventValidations.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.73% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>50/81</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">57.78% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>52/90</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">83.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>5/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">61.73% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>50/81</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-yes">7x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import services from '../services';
import models from '../models';
&nbsp;
const { Center, Event } = models,
	  {ModelService, ValidationService, UtilityService} = services;
&nbsp;
/**
 * @class EventValidations
 */
class EventValidations extends ValidationService {
  /**
   * @description validates event details
   * @static 
   * @method validateEvent
   * @memberof EventValidations
   * @return {function} An express function the handles the validations
   **/
  static validateEvent() {
    return (req, res, next) =&gt; {
        const error = new Error();
        error.code = 400;
&nbsp;
        if(req.method === 'POST') {
            const bodyObj = req.body;
	        if (bodyObj.title &amp;&amp; bodyObj.centerId &amp;&amp; bodyObj.date &amp;&amp; bodyObj.time &amp;&amp; bodyObj.estimatedGuests &amp;&amp; bodyObj.description) {
&nbsp;
                req.body.title = this.removeWhiteSpace(bodyObj.title, false);
                req.body.centerId = this.removeWhiteSpace(bodyObj.centerId);
                req.body.date = this.removeWhiteSpace(bodyObj.date);
                req.body.time = this.removeWhiteSpace(bodyObj.time, false);            
                req.body.estimatedGuests = this.removeWhiteSpace(bodyObj.estimatedGuests);
	            req.body.description = this.removeWhiteSpace(bodyObj.description, false);
&nbsp;
                /**
                 * After removing white space(s), check for empty strings
                 * and validate values
                 */
                <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.title)) //if title is empty
<span class="cstat-no" title="statement not covered" >                    error.message = 'Event title cannot be empty string!';</span>
                
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.isValidName(req.body.title)) //if valid event title
<span class="cstat-no" title="statement not covered" >                    error.message = 'Event title can only contain letters, numbers and these characters -,\''</span>
                
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.centerId)) // if center is not specified
<span class="cstat-no" title="statement not covered" >                    error.message = 'Proposed center not specified. Please, select a center.';</span>
 
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.isInteger(req.body.centerId)) // if centerId is not an integer
<span class="cstat-no" title="statement not covered" >                    error.message = 'Invalid entry for centerId, must be an integer!';</span>
                    
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.date)) // if date is empty
<span class="cstat-no" title="statement not covered" >                    error.message = 'Date cannot be empty!';</span>
&nbsp;
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.time)) // if time is empty
<span class="cstat-no" title="statement not covered" >                    error.message = 'time cannot be empty!';  </span>
&nbsp;
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.estimatedGuests)) // if estimatedGuests is empty
<span class="cstat-no" title="statement not covered" >                    error.message = 'Address cannot be empty!';</span>
&nbsp;
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.isInteger(req.body.estimatedGuests)) // if address is empty string
<span class="cstat-no" title="statement not covered" >                    error.message = 'Number of estimated guests must be an integer value';</span>
&nbsp;
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.description)) //if description is empty
<span class="cstat-no" title="statement not covered" >                    error.message = 'Description cannot be empty!';</span>
                
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.isString(req.body.description))
<span class="cstat-no" title="statement not covered" >                    error.message = 'Please, enter a valid description!'</span>
&nbsp;
            } else if (!req.body.title) //if name is not provided
                    error.message = 'Event title is required!';
            
                else <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.body.centerId) // if capacity is not provided
<span class="cstat-no" title="statement not covered" >                    error.message = 'Proposed center is required!';</span>
&nbsp;
                else if (!req.body.date) // if date is not provided
                    error.message = 'Date is required!';
&nbsp;
                else if (!req.body.time) // if time is not provided
                    error.message = 'Time is required!';
                    
                else if (!req.body.estimatedGuests) // if estimated guests is not provided
                    error.message = 'Number of estimated guests is required!'
&nbsp;
                else <span class="missing-if-branch" title="else path not taken" >E</span>if (!req.body.description) // if description is not provided
                    error.message = 'Description is required!';
&nbsp;
            } else <span class="missing-if-branch" title="else path not taken" >E</span>if (req.method === 'PUT') {
&nbsp;
                <span class="missing-if-branch" title="else path not taken" >E</span>if(typeof req.body.title !== 'undefined') { 
                    <span class="missing-if-branch" title="if path not taken" >I</span>if (this.isEmpty(req.body.title))
<span class="cstat-no" title="statement not covered" >                        error.message = 'Event title cannot be empty!';</span>
&nbsp;
                    else <span class="missing-if-branch" title="if path not taken" >I</span>if (!this.isValidName(req.body.title))
<span class="cstat-no" title="statement not covered" >                        error.message = 'Event title can only contain letters, numbers and these characters -,\''</span>
&nbsp;
                } 
                <span class="missing-if-branch" title="if path not taken" >I</span>if (!error.message &amp;&amp; typeof req.body.centerId != 'undefined') { 
<span class="cstat-no" title="statement not covered" >                    if (this.isEmpty(req.body.centerId))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Proposed center not specified. Please, select a center.';</span>
&nbsp;
                    else <span class="cstat-no" title="statement not covered" >if (!this.isInteger(req.body.centerId))</span>
<span class="cstat-no" title="statement not covered" >                        error.message =  'Invalid entry for centerId, must be an integer!';</span>
&nbsp;
                } 
                <span class="missing-if-branch" title="if path not taken" >I</span>if (!error.message &amp;&amp; typeof req.body.date !== 'undefined') {
<span class="cstat-no" title="statement not covered" >                    if (this.isEmpty(req.body.date))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Date cannot be empty!';</span>
                }
                <span class="missing-if-branch" title="if path not taken" >I</span>if (!error.message &amp;&amp; typeof req.body.time !== 'undefined') {
<span class="cstat-no" title="statement not covered" >                    if (this.isEmpty(req.body.time))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Time cannot be empty!';</span>
                } 
                <span class="missing-if-branch" title="if path not taken" >I</span>if (!error.message &amp;&amp; typeof req.body.estimatedGuests !== 'undefined') {
<span class="cstat-no" title="statement not covered" >                    if (this.isEmpty(req.body.estimatedGuests))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Number of estimated guests cannot be empty!';</span>
&nbsp;
                    else <span class="cstat-no" title="statement not covered" >if (!this.isInteger(req.body.estimatedGuests))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Number of estimated guests, must be an integer value!';</span>
&nbsp;
                }
                <span class="missing-if-branch" title="if path not taken" >I</span>if (!error.message &amp;&amp; typeof req.body.description !== 'undefined') {
<span class="cstat-no" title="statement not covered" >                    if (this.isEmpty(req.body.description))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Description cannot bet empty!';</span>
&nbsp;
                    else <span class="cstat-no" title="statement not covered" >if (!this.isString(req.body.description))</span>
<span class="cstat-no" title="statement not covered" >                        error.message = 'Please, enter a valid description!';</span>
                }
            }
&nbsp;
            return (error.message) // if error message is set, send error to client
                ? ModelService.errorResponse(res, error) 
                : next();
        }
    }
&nbsp;
    /**
     * @description validate if a particular event already exist
     * @static
     * @method isExistEvent
     * @memberof EventValidations
     * @returns {function} A middleware function that handles the validations
     */
    static isExistEvent() {
  	    return (req, res, next) =&gt; {
              
  		    <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.body.title)
<span class="cstat-no" title="statement not covered" >  			    return next();</span>
  		    else {
                req.body = this.upperCaseFirst(req.body, {bool: true});                 
	  		    return ModelService.ifExistModelObject(Event, {
                    where: {
                        userId: req.body.user.userId,
                        title: req.body.title,
                        date: req.body.date
                    },
                    message: `This ${Event.name.toLowerCase()} has already been slated for this date.`
                })
                .then(() =&gt; {
                    return next();
                })
                .catch(<span class="fstat-no" title="function not covered" >er</span>ror =&gt; {
<span class="cstat-no" title="statement not covered" >                    ModelService.errorResponse(res, error)</span>
                })
  		    }
  	    }
    }
}
export default EventValidations;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Jan 03 2018 05:29:54 GMT+0100 (W. Central Africa Standard Time)
</div>
</div>
<script src="..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\sorter.js"></script>
</body>
</html>
