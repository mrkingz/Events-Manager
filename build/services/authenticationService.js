'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var cov_2m45s3lx2a = function () {
	var path = 'C:\\Users\\kingsley\\Desktop\\Events-Manager\\server\\services\\authenticationService.js',
	    hash = 'aa860c658b974bd91a283e7fd12190505e43cf41',
	    global = new Function('return this')(),
	    gcv = '__coverage__',
	    coverageData = {
		path: 'C:\\Users\\kingsley\\Desktop\\Events-Manager\\server\\services\\authenticationService.js',
		statementMap: {
			'0': {
				start: {
					line: 20,
					column: 3
				},
				end: {
					line: 35,
					column: 7
				}
			},
			'1': {
				start: {
					line: 21,
					column: 20
				},
				end: {
					line: 25,
					column: 5
				}
			},
			'2': {
				start: {
					line: 27,
					column: 3
				},
				end: {
					line: 34,
					column: 5
				}
			},
			'3': {
				start: {
					line: 28,
					column: 4
				},
				end: {
					line: 33,
					column: 31
				}
			},
			'4': {
				start: {
					line: 29,
					column: 19
				},
				end: {
					line: 29,
					column: 30
				}
			},
			'5': {
				start: {
					line: 30,
					column: 17
				},
				end: {
					line: 30,
					column: 43
				}
			},
			'6': {
				start: {
					line: 31,
					column: 5
				},
				end: {
					line: 31,
					column: 59
				}
			},
			'7': {
				start: {
					line: 33,
					column: 9
				},
				end: {
					line: 33,
					column: 31
				}
			},
			'8': {
				start: {
					line: 48,
					column: 2
				},
				end: {
					line: 61,
					column: 3
				}
			},
			'9': {
				start: {
					line: 49,
					column: 19
				},
				end: {
					line: 52,
					column: 4
				}
			},
			'10': {
				start: {
					line: 53,
					column: 19
				},
				end: {
					line: 53,
					column: 56
				}
			},
			'11': {
				start: {
					line: 54,
					column: 3
				},
				end: {
					line: 55,
					column: 36
				}
			},
			'12': {
				start: {
					line: 55,
					column: 4
				},
				end: {
					line: 55,
					column: 36
				}
			},
			'13': {
				start: {
					line: 58,
					column: 3
				},
				end: {
					line: 58,
					column: 20
				}
			},
			'14': {
				start: {
					line: 59,
					column: 3
				},
				end: {
					line: 59,
					column: 73
				}
			},
			'15': {
				start: {
					line: 60,
					column: 3
				},
				end: {
					line: 60,
					column: 31
				}
			}
		},
		fnMap: {
			'0': {
				name: '(anonymous_0)',
				decl: {
					start: {
						line: 19,
						column: 1
					},
					end: {
						line: 19,
						column: 2
					}
				},
				loc: {
					start: {
						line: 19,
						column: 41
					},
					end: {
						line: 36,
						column: 2
					}
				},
				line: 19
			},
			'1': {
				name: '(anonymous_1)',
				decl: {
					start: {
						line: 20,
						column: 22
					},
					end: {
						line: 20,
						column: 23
					}
				},
				loc: {
					start: {
						line: 20,
						column: 43
					},
					end: {
						line: 35,
						column: 5
					}
				},
				line: 20
			},
			'2': {
				name: '(anonymous_2)',
				decl: {
					start: {
						line: 27,
						column: 49
					},
					end: {
						line: 27,
						column: 50
					}
				},
				loc: {
					start: {
						line: 27,
						column: 67
					},
					end: {
						line: 34,
						column: 4
					}
				},
				line: 27
			},
			'3': {
				name: '(anonymous_3)',
				decl: {
					start: {
						line: 46,
						column: 1
					},
					end: {
						line: 46,
						column: 2
					}
				},
				loc: {
					start: {
						line: 46,
						column: 36
					},
					end: {
						line: 62,
						column: 2
					}
				},
				line: 46
			}
		},
		branchMap: {
			'0': {
				loc: {
					start: {
						line: 28,
						column: 4
					},
					end: {
						line: 33,
						column: 31
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 28,
						column: 4
					},
					end: {
						line: 33,
						column: 31
					}
				}, {
					start: {
						line: 28,
						column: 4
					},
					end: {
						line: 33,
						column: 31
					}
				}],
				line: 28
			},
			'1': {
				loc: {
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 55,
						column: 36
					}
				},
				type: 'if',
				locations: [{
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 55,
						column: 36
					}
				}, {
					start: {
						line: 54,
						column: 3
					},
					end: {
						line: 55,
						column: 36
					}
				}],
				line: 54
			}
		},
		s: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0,
			'4': 0,
			'5': 0,
			'6': 0,
			'7': 0,
			'8': 0,
			'9': 0,
			'10': 0,
			'11': 0,
			'12': 0,
			'13': 0,
			'14': 0,
			'15': 0
		},
		f: {
			'0': 0,
			'1': 0,
			'2': 0,
			'3': 0
		},
		b: {
			'0': [0, 0],
			'1': [0, 0]
		},
		_coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
	},
	    coverage = global[gcv] || (global[gcv] = {});

	if (coverage[path] && coverage[path].hash === hash) {
		return coverage[path];
	}

	coverageData.hash = hash;
	return coverage[path] = coverageData;
}();

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _jsonwebtoken = require('jsonwebtoken');

var _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);

var _config = require('dotenv/config');

var _config2 = _interopRequireDefault(_config);

var _modelService = require('./modelService');

var _modelService2 = _interopRequireDefault(_modelService);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @description 
 * @class AuthenticationService
 */
var AuthenticationService = function () {
	function AuthenticationService() {
		_classCallCheck(this, AuthenticationService);
	}

	_createClass(AuthenticationService, null, [{
		key: 'generateJWT',

		/** 
   * @description Generates a JSON Web Token for authentication
   * @memberof AuthenticationService
   * @static
   * @param {Object} credentials Object of the user credentials
   * @param {String} secret
   * @returns {Promise.object} A promise that resolves with 
   * a json web token or rejects with an error
   */
		value: function generateJWT(credentials, secret) {
			cov_2m45s3lx2a.f[0]++;
			cov_2m45s3lx2a.s[0]++;

			return new Promise(function (resolve, reject) {
				cov_2m45s3lx2a.f[1]++;

				var options = (cov_2m45s3lx2a.s[1]++, {
					issuer: process.env.ISSUER,
					subject: process.env.SUBJECT,
					expiresIn: process.env.EXPIRATION
				});

				cov_2m45s3lx2a.s[2]++;
				return _jsonwebtoken2.default.sign(credentials, secret, options, function (error, token) {
					cov_2m45s3lx2a.f[2]++;
					cov_2m45s3lx2a.s[3]++;

					if (error) {
						cov_2m45s3lx2a.b[0][0]++;

						var _error = (cov_2m45s3lx2a.s[4]++, new Error());
						var msg = (cov_2m45s3lx2a.s[5]++, 'Could not generate token');
						cov_2m45s3lx2a.s[6]++;
						return reject(_modelService2.default.refactorError(msg, _error));
					} else {
							cov_2m45s3lx2a.b[0][1]++;
							cov_2m45s3lx2a.s[7]++;
							return resolve(token);
						}
				});
			});
		}

		/** 
   * @description Verifies a JSON Web Token's signature and returns the payload
   * @memberof AuthenticationService
   * @static
   * @param {String} token the token to verify 
   * @param {String} secreteKey the secrete key 
   * @returns {Object} An object that contains the decoded payload
   */

	}, {
		key: 'decodeJWT',
		value: function decodeJWT(token, secretKey) {
			cov_2m45s3lx2a.f[3]++;

			var decoded = void 0;
			cov_2m45s3lx2a.s[8]++;
			try {
				var options = (cov_2m45s3lx2a.s[9]++, {
					issuer: process.env.ISSUER
					//maxAge: process.env.MAX_AGE
				});
				var _decoded = (cov_2m45s3lx2a.s[10]++, _jsonwebtoken2.default.verify(token, secretKey, options));
				cov_2m45s3lx2a.s[11]++;
				if (_decoded) {
						cov_2m45s3lx2a.b[1][0]++;
						cov_2m45s3lx2a.s[12]++;

						return Promise.resolve(_decoded);
					} else {
					cov_2m45s3lx2a.b[1][1]++;
				}
			} catch (error) {
				cov_2m45s3lx2a.s[13]++;

				error.code = 401;
				cov_2m45s3lx2a.s[14]++;
				error.message = 'Access denied! Invalid authentication token provided';
				cov_2m45s3lx2a.s[15]++;
				return Promise.reject(error);
			}
		}
	}]);

	return AuthenticationService;
}();

exports.default = AuthenticationService;